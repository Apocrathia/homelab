---
variables:
  RENOVATE_BASE_DIR: $CI_PROJECT_DIR/renovate
  RENOVATE_ENDPOINT: $CI_API_V4_URL
  RENOVATE_PLATFORM: gitlab
  RENOVATE_REPOSITORY_CACHE: "enabled"
  LOG_LEVEL: debug

.renovate:
  image:
    name: ghcr.io/renovatebot/renovate:41.128.0
  script:
    - renovate

renovate:
  extends: .renovate
  stage: renovate
  resource_group: production
  variables:
    RENOVATE_CONFIG_FILE: renovate.json
    RENOVATE_AUTODISCOVER: "true"
    RENOVATE_ONBOARDING: "false"
    RENOVATE_SCHEDULE_NAME: "hourly"
  rules:
    - if: $CI_PIPELINE_SOURCE == "schedule"
  artifacts:
    when: always
    expire_in: 1d
    paths:
      - "$LOG_FILE"
  allow_failure: true
  timeout: 30m
