---
# Default values for generic-app
# This is a YAML-formatted file

app:
  # Application name - used for resource naming
  name: demo-app
  # Namespace - if not specified, uses app.name
  namespace: ""

  # Container image (single value for renovate compatibility)
  image: nginx:alpine

  container:
    name: nginx
    port: 80
    # Optional: expose extra container ports
    # Optional: set environment variables
    # env:
    #   - name: EXAMPLE_VAR
    #     value: "example"
    #   - name: SECRET_VAR
    #     valueFrom:
    #       secretKeyRef:
    #         name: my-secret
    #         key: password
    # extraPorts:
    #   - name: satellite
    #     containerPort: 16622
    #     protocol: TCP
    #   - name: satellite-2
    #     containerPort: 16623
    #     protocol: TCP

  # Optional: override the default container command
  # command: ["/custom/entrypoint"]

  # Optional: override the default container arguments
  # args: ["--custom-arg", "value"]

  # Init containers configuration
  initContainers: []
  # Example init container configuration:
  # initContainers:
  #   - name: fix-permissions
  #     image: busybox:alpine
  #     command: ["sh", "-c"]
  #     args: ["chown -R 1000:1000 /app/assets"]
  #     volumeMounts:
  #       - name: app-data
  #         mountPath: /app
  #     securityContext:
  #       runAsUser: 0
  #       runAsGroup: 0
  #       runAsNonRoot: false

  # Sidecar containers configuration
  sidecars: []
  # Example sidecar configuration:
  # sidecars:
  #   - name: nginx-sidecar
  #     image: nginx:alpine
  #     command: ["/bin/sh"]
  #     args: ["-c", "while true; do echo 'Sidecar running'; sleep 30; done"]
  #     ports:
  #       - containerPort: 8080
  #         name: sidecar-port
  #     env:
  #       - name: SIDECAR_VAR
  #         value: "sidecar-value"
  #     volumeMounts:
  #       - name: shared-data
  #         mountPath: /shared
  #     resources:
  #       requests:
  #         cpu: 10m
  #         memory: 16Mi
  #       limits:
  #         cpu: 50m
  #         memory: 32Mi

  # Deployment configuration
  replicas: 1

  # Pod anti-affinity configuration (helps spread replicas across nodes)
  podAntiAffinity:
    enabled: true

  # Security context (defaults to 1000)
  securityContext:
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000
    # File system group change policy for volume ownership
    # "OnRootMismatch" automatically changes volume ownership when it doesn't match fsGroup
    # fsGroupChangePolicy: "OnRootMismatch"
    # Allow disabling readOnlyRootFilesystem for containers that need write access during init
    # (e.g., LinuxServer.io containers with s6-overlay)
    readOnlyRootFilesystem: true
    # Allow containers to run as root (e.g., LinuxServer.io containers with s6-overlay)
    runAsNonRoot: true
    # Allow privilege escalation if needed for init processes
    allowPrivilegeEscalation: false
    # Container capabilities configuration
    # capabilities:
    #   # Capabilities to add (useful for init containers or special requirements)
    #   add:
    #     - SETUID      # Allow changing user IDs
    #     - SETGID      # Allow changing group IDs
    #     - CHOWN       # Allow changing file ownership
    #     - DAC_OVERRIDE # Allow bypassing file permission checks
    #   # Capabilities to drop (defaults to ALL if not specified)
    #   drop:
    #     - NET_RAW     # Drop network raw socket capability

  # Resource requests and limits
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 100m
      memory: 128Mi

  # Service configuration
  service:
    type: ClusterIP
    port: 80
    targetPort: 80
    portName: http

  # Volume configuration
  volumes:
    # Empty directory volumes
    emptyDir:
      - name: nginx-cache
        mountPath: /var/cache/nginx
      - name: nginx-run
        mountPath: /run

# ConfigMap volumes
# configMap:
#   - name: my-config
#     mountPath: /etc/config
#     subPath: config.yaml
#     readOnly: true
#     configMapName: my-configmap

# Storage configuration
storage:
  # Longhorn persistent storage
  longhorn:
    enabled: true
    capacity: 10Gi # Size is calculated automatically from capacity
    replicas: 3
    staleReplicaTimeout: 30
    mountPath: /app

  # SMB storage for read-only files
  smb:
    enabled: true
    capacity: 1Gi
    source: "//storage.services.apocrathia.com/Library"
    subDir: "Sites/Demo"
    mountPath: /usr/share/nginx/html
    credentialsPath: "vaults/Secrets/items/smb-credentials"

# 1Password secrets integration
secrets:
  enabled: true
  itemPath: "vaults/Secrets/items/demo-app-secrets"

# Authentik SSO integration
authentik:
  enabled: true
  displayName: "Demo Application"
  externalHost: "https://demo.gateway.services.apocrathia.com"
  icon: "https://i.imgur.com/0gNsvyk.png"
  openInNewTab: true
  # Enable header-based authentication for reverse proxy auth
  interceptHeaderAuth: false

  # Flow configuration
  authorizationFlow: "default-provider-authorization-implicit-consent"
  invalidationFlow: "default-invalidation-flow"
  authenticationFlow: "default-authentication-flow"

  # Authentik server configuration
  authentikHost: "https://auth.gateway.services.apocrathia.com"
  authentikHostInsecure: true
  serviceConnection: "Local Kubernetes Cluster"

  # Outpost configuration
  replicas: 1
  namespace: authentik
  logLevel: info

  # Gateway configuration
  gateway:
    name: main-gateway
    namespace: cilium-system
    sectionName: https

# HTTPRoute configuration (only used when authentik.enabled is false)
httproute:
  enabled: false
  hostname: demo.gateway.services.apocrathia.com
  gateway:
    name: main-gateway
    namespace: cilium-system
    sectionName: https

# TCPRoute configuration for additional ports
tcproute:
  enabled: false
  routes: []

# UDPRoute configuration for additional UDP ports
udproute:
  enabled: false
  routes: []

# LoadBalancer configuration for direct external access
loadbalancer:
  enabled: false
  # IP address for the LoadBalancer (required when enabled)
  ip: ""
  # Ports to expose externally (in addition to main service port)
  ports: []
  # External traffic policy for LoadBalancer (Local or Cluster)
  externalTrafficPolicy: Local
  # Example ports configuration:
  # ports:
  #   - name: satellite
  #     port: 16622
  #     targetPort: 16622
  #     protocol: TCP

  # Cilium configuration
  cilium:
    # Network interface for L2 announcements
    interface: eth0
    # Namespace where Cilium resources should be created
    namespace: cilium-system
