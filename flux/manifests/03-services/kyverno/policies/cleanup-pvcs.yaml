---
apiVersion: kyverno.io/v2
kind: ClusterCleanupPolicy
metadata:
  name: cleanup-released-pvcs
  annotations:
    policies.kyverno.io/title: Cleanup Released PVCs
    policies.kyverno.io/category: Other
    policies.kyverno.io/severity: medium
    policies.kyverno.io/subject: PersistentVolumeClaim
    kyverno.io/kyverno-version: 1.11.1
    policies.kyverno.io/minversion: 1.9.0
    kyverno.io/kubernetes-version: "1.27"
    policies.kyverno.io/description: >-
      Cleans up PersistentVolumeClaims that are in Released status to prevent
      accumulation of orphaned PVC resources in the cluster.
spec:
  match:
    any:
      - resources:
          kinds:
            - PersistentVolumeClaim
  exclude:
    any:
      - resources:
          namespaces:
            - kube-system
  conditions:
    all:
      - key: "{{ target.status.phase }}"
        operator: Equals
        value: "Released"
  schedule: "0 * * * *" # Hourly
