---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: reloader
  namespace: stakater
spec:
  interval: 1h
  chart:
    spec:
      # renovate: datasource=helm depName=reloader registryUrl=https://stakater.github.io/stakater-charts
      chart: reloader
      version: "1.2.1"
      sourceRef:
        kind: HelmRepository
        name: stakater
        namespace: flux-system
  values:
    reloader:
      watchGlobally: true
      reloadStrategy: "default"
      logFormat: "json"
      enableHA: true
      # Ignore kube-system and flux-system to avoid unnecessary reloads
      ignoreNamespaces: "kube-system,flux-system"
      # Enable metrics for monitoring
      enableMetricsByNamespace: true
      # Enable pod disruption budget for HA
      podDisruptionBudget:
        enabled: true
      deployment:
        replicas: 2
        resources:
          requests:
            cpu: 100m
            memory: 128Mi
          limits:
            cpu: 200m
            memory: 256Mi
        # Add security context for better security
        securityContext:
          runAsNonRoot: true
          runAsUser: 1000
        containerSecurityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
