---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
metadata:
  name: companion
  namespace: bitfocus
  labels:
    app.kubernetes.io/name: companion

resources:
  - namespace.yaml
  - helmrelease.yaml
  - ../../03-services/gateway # Include the gateway resources since we're patching it
patches:
  - target:
      group: gateway.networking.k8s.io
      version: v1
      kind: Gateway
      name: main-gateway
      namespace: cilium-system
    patch: |
      - op: add
        path: /spec/listeners/-
        value:
          name: bitfocus-satellite
          protocol: TCP
          port: 16622
          allowedRoutes:
            namespaces:
              from: All
