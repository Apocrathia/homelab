---
# Daily backup of all volumes
# All times are UTC (cluster timezone). MST = UTC-7.
apiVersion: longhorn.io/v1beta2
kind: RecurringJob
metadata:
  name: daily-backup
  namespace: longhorn-system
spec:
  cron: "0 7 * * *" # 0000 MST = 0700 UTC
  task: "backup"
  groups:
    - default
  retain: 3
  concurrency: 10 # Increased to process more volumes per day (75 volumes need higher concurrency)
---
# Weekly filesystem trim
apiVersion: longhorn.io/v1beta2
kind: RecurringJob
metadata:
  name: weekly-trim
  namespace: longhorn-system
spec:
  cron: "0 8 * * 0" # 0100 MST Sunday = 0800 UTC Sunday
  task: "filesystem-trim"
  groups:
    - default
  retain: 3
  concurrency: 2
---
# Daily snapshot cleanup to remove system-generated snapshots
# This prevents accumulation of snapshots that weren't cleaned up automatically
# Runs at 2300 MST (before backups at 0000)
apiVersion: longhorn.io/v1beta2
kind: RecurringJob
metadata:
  name: snapshot-cleanup
  namespace: longhorn-system
spec:
  cron: "0 6 * * *" # 2300 MST = 0600 UTC
  task: "snapshot-cleanup"
  groups:
    - default
  concurrency: 2
---
# Snapshot deletion to enforce retention policy (keep only 3 most recent)
# This deletes old snapshots beyond the retention limit
# Runs daily at 0200 MST (after backup job completes at 0000)
apiVersion: longhorn.io/v1beta2
kind: RecurringJob
metadata:
  name: snapshot-delete
  namespace: longhorn-system
spec:
  cron: "0 9 * * *" # 0200 MST = 0900 UTC
  task: "snapshot-delete"
  groups:
    - default
  retain: 3 # Match backup retention (3 daily backups)
  concurrency: 2
