---
# yaml-language-server: $schema=https://kubernetes-schemas.devbu.io/helm.toolkit.fluxcd.io/helmrelease_v2beta1.json
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: longhorn
  namespace: longhorn-system
spec:
  interval: 30m
  chart:
    spec:
      chart: longhorn
      # renovate: datasource=helm registryUrl=https://charts.longhorn.io depName=longhorn
      version: 1.9.1
      sourceRef:
        kind: HelmRepository
        name: longhorn
        namespace: flux-system
  maxHistory: 2
  install:
    remediation:
      retries: 3
  upgrade:
    cleanupOnFail: true
    remediation:
      retries: 3
  uninstall:
    keepHistory: false
  values:
    defaultSettings:
      backupTarget: cifs://storage.services.apocrathia.com/Backup
      backupTargetCredentialSecret: longhorn-backup-target-secret
      restoreVolumeRecurringJobs: true
      backupCompressionMethod: gzip
      deletingConfirmationFlag: true

    longhornUI:
      replicas: 2

    ingress:
      enabled: false
      host: longhorn.k8s.apocrathia.com

    #  For Kubernetes < v1.25, if your cluster enables Pod Security Policy admission controller,
    #  set this to `true` to ship longhorn-psp which allow privileged Longhorn pods to start
    enablePSP: false

    ## Specify override namespace, specifically this is useful for using longhorn as sub-chart
    ## and its release namespace is not the `longhorn-system`
    namespaceOverride: ""

    # Annotations to add to the Longhorn Manager DaemonSet Pods. Optional.
    annotations: {}

    serviceAccount:
      # Annotations to add to the service account
      annotations: {}
